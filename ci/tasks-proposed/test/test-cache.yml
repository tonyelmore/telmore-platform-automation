---
platform: linux

params:
  FAIL_FLAG: false
  SOME_STRING: "this is some default string"
  PIVNET_TOKEN:


caches:
- path: first-directory
- path: second-directory
- path: third-directory

run:
  path: bash
  args:
  - "-c"
  - |
    cat /var/version && echo ""
    set -eux

    date >> first-directory/first-file
    date >> second-directory/second-file

    echo "output from first-directory/first-file"
    cat first-directory/first-file

    om download-product \
      --pivnet-api-token $PIVNET_TOKEN \
      --pivnet-product-slug vmware-nsx-t \
      --product-version 4.1.2.1 \
      --file-glob VMware-NSX-T-4.1.2.1.23305119.pivotal \
      --output-directory third-directory

    ls -al third-directory

    echo "String from param is: ${SOME_STRING}"
    if [ $FAIL_FLAG == "true" ]; then
      echo "Making the task fail"
      exit 1
    fi

    echo "Task succeeded"
    exit 0
